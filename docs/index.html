<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="delegate.js,JavaScript,Event,Delegate">
  <meta name="description"
        content="delegate.js 是一个轻量级的 JavaScript 事件委托库。delegate.js 中封装了：on()、once()、off() 等事件侦听相关的常用方法。delegate.js 的 API 借鉴了 jQuery 的链式调用模式，使得 delegate.js 的 API 使用起来非常灵活和方便。">
  <title>delegate.js</title>
  <link href="css/style.css" type="text/css" rel="stylesheet">
</head>
<body>
<header class="header">
  <h1 class="title">delegate.js</h1>
  <a href="https://github.com/yaohaixiao/delegate.js/archive/refs/heads/main.zip" class="download">Download
    delegate.js</a>
</header>
<section class="project">
  <p>
    <a href="https://github.com/yaohaixiao/delegate.js">GitHub</a>
    <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <a href="https://github.com/yaohaixiao/delegate.js/issues">Issues</a>
  </p>
</section>
<section class="container">
  <h2 class="section-title">delegate.js</h2>
  <section class="usage">delegate.js 是一个轻量级的 JavaScript 事件委托库。delegate.js 中封装了：on()、once()、off()
    等事件侦听相关的常用方法。delegate.js 的 API 借鉴了 jQuery 的链式调用模式，使得 delegate.js 的 API 使用起来非常灵活和方便。
  </section>
  <h2 class="section-title">特点</h2>
  <section class="usage">
    <ul>
      <li>1. 支持 UMD 规范；</li>
      <li>2. 原生 JavaScript 编写，无任何依赖；</li>
      <li>3. 采用 jQuery 链式调用语法，调用语法简洁方便；</li>
      <li>4. 文件体积小，加载速度快；</li>
    </ul>
  </section>
  <h2 class="section-title">安装说明</h2>
  <p>delegate.js 支持 AMD 和 CommonJS 规范的模块调用方式，可以直接使用 npm 安装，也可以使用 script 标签引入到页面。</p>
  <section class="usage">
    <h3 class="usage-title">npm 安装</h3>
    <pre class="code"><code>npm i -S @yaohaixiao/delegate.js</code></pre>
    <h3 class="usage-title">CDN 调用 JS 文件</h3>
    <pre class="code"><code>&lt;script src="https://cdn.jsdelivr.net/gh/yaohaixiao/delegate.js/dist/delegate.min.js"&gt;&lt;/script&gt;</code></pre>
    <h3 class="usage-title">本地调用 JS 文件</h3>
    <pre class="code"><code>&lt;script src="/path/to/delegate.js"&gt;&lt;/script&gt;</code></pre>
  </section>
  <h2 class="section-title">DEMO</h2>
  <section class="demo">
    <section class="demo-col">
      <pre class="code"><code>&lt;ul id="list" class="list"&gt;
&lt;/ul&gt;
&lt;script src="js/delegate.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
// ...省略获取操作按钮的逻辑
const $list = document.querySelector('#list')
const $emitter = delegate($list)
const removeItem = function (evt) {
  const $removeButton = evt.delegateTarget
  const id = parseInt($removeButton.getAttribute('data-id'), 10)
  const $textarea = document.querySelector('#log-textarea')
  // 阻止事件冒泡，不触发执行 showLog() 回调函数
  // 同时阻止删除链接的默认行为，页面不会跳转
  $emitter.stopEvent(evt)
  // 省略删除的逻辑
  $textarea.value += `你删除的 li 节点的 id 为 item-${id}\r`
}
const showLog = function (evt) {
  const $li = evt.delegateTarget
  const $textarea = document.querySelector('#log-textarea')
  $textarea.value += `你点击的 li 节点的 id 为 ${$li.id}\r`
}
const onRemove = () => {
  $emitter.on('.remove', 'click', removeItem)
}
const offRemove = () => {
  $emitter.off('click', removeItem)
}
const onItem = () => {
  $emitter.on('.item', 'click', showLog)
}
const offItem = () => {
  $emitter.off('click', showLog)
}
const onAll = () => {
  onRemove()
  onItem()
}
const offAll = () => {
  $emitter.destroy()
}
// 动态绘制 #list 的内容（实现代码省略）
draw()
onAll()
// ...省略操作按钮的事件绑定逻辑
&lt;/script&gt;</code></pre>
    </section>
    <section class="demo-col">
      <div class="demo-actions">
        <span class="demo-action" id="off-item">解除 .item 绑定</span>
        <span class="demo-action" id="on-item">恢复 .item 绑定</span>
        <span class="demo-action" id="off-remove">解除 .remove 绑定</span>
        <span class="demo-action" id="on-remove">恢复 .remove 绑定</span>
        <span class="demo-action" id="off-all">解除所有绑定</span>
        <span class="demo-action" id="on-all">恢复所有绑定</span>
      </div>
      <ul id="list" class="list">
      </ul>
      <div class="demo-actions">
        <span class="demo-action" id="add">添加行</span>
      </div>
      <div class="demo-log">
        <textarea id="log-textarea" class="log-textarea"></textarea>
      </div>
    </section>
  </section>
  <h2 class="section-title">License</h2>
  <section class="usage">
    <p>Licensed under MIT License.</p>
  </section>
</section>
<footer class="footer">
  <p>Copyright &copy; 2008-2023 <a href="http://www.yaohaixiao.com/">Yaohaixiao</a>, all right reserved.
  </p>
</footer>
<script src="js/delegate.min.js"></script>
<script>
  let options = [
    {
      id: 1,
      text: 'Item 1'
    },
    {
      id: 2,
      text: 'Item 2'
    },
    {
      id: 3,
      text: 'Item 3'
    },
    {
      id: 4,
      text: 'Item 4'
    },
    {
      id: 5,
      text: 'Item 5'
    }
  ]
  let isRemoveOn = true
  let isItemOn = true

  const $buttonOnRemove = document.querySelector('#on-remove')
  const $buttonOffRemove = document.querySelector('#off-remove')
  const $buttonOnItem = document.querySelector('#on-item')
  const $buttonOffItem = document.querySelector('#off-item')
  const $buttonOnAll = document.querySelector('#on-all')
  const $buttonOffAll = document.querySelector('#off-all')
  const $buttonAdd = document.querySelector('#add')
  const $list = document.querySelector('#list')
  const $emitter = delegate($list)

  const draw = () => {
    let items = []

    options.forEach((option) => {
      const id = option.id
      const item = `<li id="${'item-' + id}" class="item">` +
        `<span class="label">${'Item-' + id}</span>` +
        `<a href="#list" class="remove" data-id="${id}">删除</a>` +
        `</li>`

      items.push(item)
    })

    $list.innerHTML = items.join('')
  }

  const addItem = function () {
    const length = options.length
    const id = length > 0 ? options[length - 1].id + 1 : 1
    const option = { id: id, text: `Item-${id}` }
    const $textarea = document.querySelector('#log-textarea')

    options.push(option)

    draw()

    $textarea.value += `你添加的 li 节点的 id 为 item-${id}\r`
  }

  const removeItem = function (evt) {
    const $removeButton = evt.delegateTarget
    const id = parseInt($removeButton.getAttribute('data-id'), 10)
    const $textarea = document.querySelector('#log-textarea')

    // 阻止删除链接的默认行为
    $emitter.stopEvent(evt)

    options = options.filter((option) => id !== option.id)

    draw()

    $textarea.value += `你删除的 li 节点的 id 为 item-${id}\r`
  }

  const showLog = function (evt) {
    const pageX = $emitter.getPageX(evt)
    const pageY = $emitter.getPageY(evt)
    const $li = evt.delegateTarget
    const $textarea = document.querySelector('#log-textarea')

    $textarea.value += `你点击的 li 节点的 id 为 ${$li.id}\r`
    $textarea.value += `pageX 为：${pageX}\r`
    $textarea.value += `pageY 为：${pageY}\r`
  }

  const onRemove = () => {
    // 强制使用事件捕获模型
    $emitter.on('.remove', 'click', removeItem)
    isRemoveOn = true
    updateButtons()
  }
  const offRemove = () => {
    $emitter.off('click', removeItem)
    isRemoveOn = false
    updateButtons()
  }
  const onItem = () => {
    $emitter.on('.item', 'click', showLog)
    isItemOn = true
    updateButtons()
  }
  const offItem = () => {
    $emitter.off('click', showLog)
    isItemOn = false
    updateButtons()
  }
  const onAll = () => {
    onRemove()
    onItem()
    isRemoveOn = true
    isItemOn = true
    updateButtons()

  }
  const offAll = () => {
    $emitter.destroy()
    isRemoveOn = false
    isItemOn = false
    updateButtons()
  }
  const updateButtons = () => {
    if(isRemoveOn){
      $buttonOnRemove.style.display = 'none'
      $buttonOffRemove.style.display = 'inline-block'
    } else {
      $buttonOnRemove.style.display = 'inline-block'
      $buttonOffRemove.style.display = 'none'
    }

    if(isItemOn){
      $buttonOnItem.style.display = 'none'
      $buttonOffItem.style.display = 'inline-block'
    } else {
      $buttonOnItem.style.display = 'inline-block'
      $buttonOffItem.style.display = 'none'
    }

    if(isItemOn || isRemoveOn){
      $buttonOnAll.style.display = 'none'
      $buttonOffAll.style.display = 'inline-block'
    } else {
      $buttonOnAll.style.display = 'inline-block'
      $buttonOffAll.style.display = 'none'
    }
  }

  draw()
  onAll()

  $buttonOnRemove.addEventListener('click', onRemove)
  $buttonOffRemove.addEventListener('click', offRemove)
  $buttonOnItem.addEventListener('click', onItem)
  $buttonOffItem.addEventListener('click', offItem)
  $buttonOnAll.addEventListener('click', onAll)
  $buttonOffAll.addEventListener('click', offAll)
  $buttonAdd.addEventListener('click', addItem)
</script>
</body>
</html>
